@page "/splitter-features"
@rendermode InteractiveServer
@using Syncfusion.Blazor
@using Syncfusion.Blazor.Layouts
@using Syncfusion.Blazor.FileManager
@using TestSyncfusionBlazorCopilot.Services
@inject NavigationManager UriHelper

<div class="control-section" style="height:100vh;">
    <SfSplitter Width="100%" Height="100vh" Orientation="Syncfusion.Blazor.Layouts.Orientation.Horizontal" SeparatorSize="4">
        <SplitterPanes>
            <SplitterPane Size="40%">
                <ContentTemplate>
                    <SfFileManager TValue="FileManagerDirectoryContent">
                        <FileManagerEvents TValue="FileManagerDirectoryContent" OnRead="OnReadAsync" ItemsDeleting="ItemsDeletingAsync" FolderCreating="FolderCreatingAsync" Searching="SearchingAsync" ItemRenaming="ItemRenamingAsync" ItemsMoving="ItemsMovingAsync" BeforeImageLoad="BeforeImageLoadAsync"></FileManagerEvents>
                        <FileManagerToolbarSettings ToolbarItems="@Items"></FileManagerToolbarSettings>
                        <FileManagerContextMenuSettings Layout="@LayoutItems" File=@FileItems Folder=@FolderItems Visible="true"></FileManagerContextMenuSettings>
                    </SfFileManager>
                </ContentTemplate>
            </SplitterPane>
            <SplitterPane Size="60%">
                <ContentTemplate>
                    <div style="padding:20px; text-align:center;">Right Pane (60%)</div>
                </ContentTemplate>
            </SplitterPane>
        </SplitterPanes>
    </SfSplitter>
</div>

@code{
    public List<ToolBarItemModel> Items = new List<ToolBarItemModel>()
    {
        new ToolBarItemModel() { Name = "NewFolder" },
        new ToolBarItemModel() { Name = "Cut" },
        new ToolBarItemModel() { Name = "Copy" },
        new ToolBarItemModel() { Name = "Paste" },
        new ToolBarItemModel() { Name = "Delete" },
        new ToolBarItemModel() { Name = "Rename" },
        new ToolBarItemModel() { Name = "SortBy" },
        new ToolBarItemModel() { Name = "Refresh" },
        new ToolBarItemModel() { Name = "Selection" },
        new ToolBarItemModel() { Name = "View" },
        new ToolBarItemModel() { Name = "Details" },
    };
    public string[] LayoutItems = new string[] { "SortBy", "View", "Refresh", "|", "Paste", "|", "NewFolder", "|", "Details", "|", "SelectAll" };
    public string[] FileItems = new string[] { "Cut", "Copy", "|", "Delete", "Rename", "|", "Details" };
    public string[] FolderItems = new string[] { "Open", "|", "Cut", "Copy", "Paste", "|", "Delete", "Rename", "|", "Details"};
    public FileManagerService FileService = new FileManagerService();
    public async Task OnReadAsync(ReadEventArgs<FileManagerDirectoryContent> args)
    {
        args.Response = await FileService.ReadAsync(args.Path, args.Folder);
    }
    public async Task ItemsDeletingAsync(ItemsDeleteEventArgs<FileManagerDirectoryContent> args)
    {
        args.Response = await FileService.DeleteAsync(args.Path, args.Files);
    }
    public async Task FolderCreatingAsync(FolderCreateEventArgs<FileManagerDirectoryContent> args)
    {
        args.Response = await FileService.CreateAsync(args.Path, args.FolderName, args.ParentFolder);
    }
    public async Task SearchingAsync(SearchEventArgs<FileManagerDirectoryContent> args)
    {
        args.Response = await FileService.SearchAsync(args.Path, args.SearchText);
    }
    public async Task ItemRenamingAsync(ItemRenameEventArgs<FileManagerDirectoryContent> args)
    {
        args.Response = await FileService.RenameAsync(args.Path, args.NewName, args.File);
    }
    public async Task ItemsMovingAsync(ItemsMoveEventArgs<FileManagerDirectoryContent> args)
    {
        if (args.IsCopy)
        {
            args.Response = await FileService.CopyAsync(args.Path, args.TargetData, args.RenameFiles, args.Files);
        }
        else{
            args.Response = await FileService.MoveAsync(args.Path, args.TargetData, args.Files);
        }
    }
    public void BeforeImageLoadAsync(BeforeImageLoadEventArgs<FileManagerDirectoryContent> args)
    {
        string relativePath = $"images/filemanager/{args.FileDetails.Name}";
        args.ImageUrl = UriHelper.ToAbsoluteUri(relativePath).ToString();
    }
}
