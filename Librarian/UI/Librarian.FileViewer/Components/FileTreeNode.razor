@using Librarian.FileViewer.Models

<div class="tree-node">
    <div class="tree-node-header" @onclick="ToggleExpanded">
        <span class="tree-node-icon">
            @if (Item.IsFile)
            {
                <i class="e-icons e-file-text"></i>
            }
            else
            {
                <i class="e-icons @(isExpanded ? "e-folder-open" : "e-folder")"></i>
            }
        </span>
        <span class="tree-node-text @(Item.IsFile ? "file" : "folder")" @onclick="() => OnNodeClick(Item)">
            @Item.Name
        </span>
        @if (!Item.IsFile && Item.Children?.Any() == true)
        {
            <span class="tree-node-toggle">
                <i class="e-icons @(isExpanded ? "e-chevron-down" : "e-chevron-right")"></i>
            </span>
        }
    </div>
    
    @if (!Item.IsFile && isExpanded && Item.Children?.Any() == true)
    {
        <div class="tree-node-children">
            @foreach (var child in Item.Children)
            {
                <FileTreeNode Item="child" OnFileSelected="OnFileSelected" />
            }
        </div>
    }
</div>

@code {
    [Parameter] public FileHierarchyItem Item { get; set; } = null!;
    [Parameter] public EventCallback<FileHierarchyItem> OnFileSelected { get; set; }
    
    private bool isExpanded = false;
    
    private void ToggleExpanded()
    {
        if (!Item.IsFile)
        {
            isExpanded = !isExpanded;
        }
    }
    
    private async Task OnNodeClick(FileHierarchyItem item)
    {
        if (item.IsFile)
        {
            await OnFileSelected.InvokeAsync(item);
        }
        else
        {
            ToggleExpanded();
        }
    }
}

<style>
    .tree-node {
        margin: 0;
        padding: 0;
    }
    
    .tree-node-header {
        display: flex;
        align-items: center;
        padding: 4px 8px;
        cursor: pointer;
        user-select: none;
        border-radius: 4px;
        transition: background-color 0.2s;
    }
    
    .tree-node-header:hover {
        background-color: #f0f0f0;
    }
    
    .tree-node-icon {
        margin-right: 6px;
        font-size: 16px;
        color: #666;
    }
    
    .tree-node-text {
        flex: 1;
        font-size: 14px;
        color: #333;
    }
    
    .tree-node-text.file {
        color: #0066cc;
    }
    
    .tree-node-text.folder {
        color: #666;
        font-weight: 500;
    }
    
    .tree-node-toggle {
        margin-left: auto;
        font-size: 12px;
        color: #999;
    }
    
    .tree-node-children {
        margin-left: 20px;
        border-left: 1px solid #e0e0e0;
        padding-left: 4px;
    }
</style>